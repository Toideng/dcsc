#!/bin/bash

module="dcsc"
device="dcsc"
mode="664"
minors=16

# invoke insmod with all arguments we got
insmod ./$module.ko $* || exit 1

if [[ 0 == 0 ]]
then
	# Group: since distributions do it differently, look for wheel or use staff
	if grep '^staff:' /etc/group > /dev/null; then
		group="staff"
	else
		group="wheel"
	fi
	major=`cat /proc/devices | awk "\\$2==\"$module\" {print \\$1}"`

	# Remove stale nodes and replace them, then give gid and perms

	rm -f /dev/${device}a* /dev/${device}

	mknod /dev/${device}a b $major 0
	ln -sf ${device}a /dev/${device}
	chgrp $group /dev/${device}a*
	chmod $mode  /dev/${device}a*
fi
